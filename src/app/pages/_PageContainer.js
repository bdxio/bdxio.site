import React, { Component } from 'react';
import { PropTypes } from 'prop-types';
import { connect } from 'react-redux';
import Footer from '../components/common/Footer.component';
import Menu from '../components/common/Menu.componet';

import { Constants } from '../constants';
import { Actions as GSheetActions } from '../actions/gsheet.actions';

const displayPage = (Page) => {
    class DisplayPage extends Component {

        constructor(props) {
            super(props);
            this.state = {
                isOnTop: true,
            };
            this._onScroll = this._onScroll.bind(this);
        }

        componentWillMount() {
            this.props.dispatch(GSheetActions.fetch());

            document.addEventListener('scroll', this._onScroll);
        }

        componentWillUnmount() {
            document.removeEventListener('scroll', this._onScroll);
        }

        _onScroll() {
            const isOnTop = window.scrollY < 100;
            if (isOnTop !== this.state.isOnTop) {
                this.setState({ isOnTop })
            }
        }

        render() {
            const { isOnTop } = this.state;
            const { loaded, Sponsors } = this.props.gsheet;
            const IMPERIAL = Sponsors.filter((s) => s['Actif'] === '1' && s['Type'].toUpperCase() === Constants.sponsors.types.IMPERIAL);

            if (loaded) {
                return (
                    <div>
                        <Menu pathname={this.props.location.pathname} isOnTop={isOnTop} />
                        <Page {...this.props} />
                        <Footer style={{ marginTop: (IMPERIAL.length === 0 ? '0px' : '64px') }} />
                    </div>
                );
            }
            else {
                return (
                   <svg version="1.1" id="loader" xmlns="http://www.w3.org/2000/svg"
                        xmlnsXlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                        viewBox="0 0 441 189" xmlSpace="preserve">
                            <path className="st0" d="M26.9,164.6c0.5,0.1,1.2,0.1,2.1,0.1c2.6,0,4.9-0.9,4.9-3.7c0-2.6-2.3-3.7-5-3.7h-2V164.6z M26.9,155.4h2.2
                                c2.6,0,4.2-1.4,4.2-3.2c0-2.2-1.7-3.1-4.2-3.1c-1.1,0-1.8,0.1-2.2,0.2V155.4z M24.4,147.5c1.1-0.2,2.8-0.4,4.5-0.4
                                c2.5,0,4.1,0.4,5.3,1.4c1,0.7,1.6,1.9,1.6,3.4c0,1.8-1.2,3.5-3.2,4.2v0.1c1.8,0.5,4,2,4,4.8c0,1.7-0.7,2.9-1.6,3.8
                                c-1.3,1.2-3.5,1.8-6.6,1.8c-1.7,0-3-0.1-3.8-0.2V147.5z"/>
                            <path className="st0" d="M41.4,159.6c0,3,1.7,5.3,4.2,5.3c2.4,0,4.2-2.2,4.2-5.3c0-2.3-1.2-5.3-4.1-5.3C42.7,154.2,41.4,157,41.4,159.6
                                 M52.3,159.4c0,5.1-3.5,7.3-6.9,7.3c-3.7,0-6.6-2.7-6.6-7.1c0-4.6,3-7.3,6.8-7.3C49.7,152.4,52.3,155.2,52.3,159.4"/>
                            <path className="st0" d="M55.5,157c0-1.6,0-3-0.1-4.3h2.2l0.1,2.7h0.1c0.6-1.8,2.1-3,3.8-3c0.3,0,0.5,0,0.7,0.1v2.4
                                c-0.3-0.1-0.5-0.1-0.9-0.1c-1.8,0-3,1.3-3.4,3.2c-0.1,0.3-0.1,0.7-0.1,1.2v7.3h-2.5V157z"/>
                            <path className="st0" d="M74,158.3c0-0.3,0-0.7-0.1-1.1c-0.4-1.6-1.7-2.9-3.6-2.9c-2.6,0-4.1,2.3-4.1,5.3c0,2.8,1.4,5.1,4.1,5.1
                                c1.7,0,3.2-1.1,3.7-3c0.1-0.3,0.1-0.7,0.1-1.1V158.3z M76.5,146.3v16.6c0,1.2,0,2.6,0.1,3.6h-2.3l-0.1-2.4h-0.1
                                c-0.8,1.5-2.5,2.7-4.7,2.7c-3.3,0-5.9-2.8-5.9-7c0-4.6,2.8-7.4,6.2-7.4c2.1,0,3.5,1,4.2,2.1H74v-8.2H76.5z"/>
                            <path className="st0" d="M89.4,158.2c0-1.6-0.7-4.1-3.5-4.1c-2.5,0-3.6,2.3-3.8,4.1H89.4z M82,160c0.1,3.4,2.2,4.8,4.7,4.8
                                c1.8,0,2.9-0.3,3.8-0.7l0.4,1.8c-0.9,0.4-2.4,0.9-4.6,0.9c-4.2,0-6.8-2.8-6.8-6.9c0-4.1,2.5-7.4,6.5-7.4c4.5,0,5.7,3.9,5.7,6.5
                                c0,0.5-0.1,0.9-0.1,1.2H82z"/>
                            <path className="st0" d="M102.2,159.4c-2.7-0.1-5.8,0.4-5.8,3.1c0,1.6,1.1,2.4,2.4,2.4c1.8,0,2.9-1.1,3.3-2.3c0.1-0.3,0.1-0.5,0.1-0.8
                                V159.4z M102.6,166.4l-0.2-1.7h-0.1c-0.8,1.1-2.2,2-4.2,2c-2.8,0-4.2-2-4.2-3.9c0-3.3,3-5.1,8.3-5.1v-0.3c0-1.1-0.3-3.2-3.1-3.2
                                c-1.3,0-2.6,0.4-3.6,1l-0.6-1.7c1.1-0.7,2.8-1.2,4.5-1.2c4.2,0,5.2,2.9,5.2,5.6v5.1c0,1.2,0.1,2.4,0.2,3.3H102.6z"/>
                            <path className="st0" d="M120.2,162.7c0,1.4,0,2.7,0.1,3.8h-2.2l-0.1-2.2h-0.1c-0.7,1.1-2.1,2.6-4.6,2.6c-2.2,0-4.8-1.2-4.8-6v-8h2.5
                                v7.6c0,2.6,0.8,4.4,3.1,4.4c1.7,0,2.8-1.2,3.3-2.3c0.1-0.4,0.2-0.8,0.2-1.3v-8.4h2.5V162.7z"/>
                            <path className="st0" d="M125.5,152.7l2,3c0.5,0.8,0.9,1.5,1.4,2.2h0.1c0.5-0.8,0.9-1.5,1.4-2.3l1.9-2.9h2.7l-4.7,6.6l4.8,7.1h-2.8
                                l-2-3.1c-0.5-0.8-1-1.6-1.5-2.4h-0.1c-0.5,0.8-0.9,1.6-1.5,2.4l-2,3.1h-2.8l4.9-7l-4.7-6.7H125.5z"/>
                            <path className="st0" d="M146.2,164.5c0.6,0.1,1.5,0.1,2.5,0.1c5.3,0,8.2-3,8.2-8.1c0-4.5-2.5-7.4-7.8-7.4c-1.3,0-2.2,0.1-2.9,0.3V164.5
                                z M143.7,147.5c1.5-0.2,3.3-0.4,5.3-0.4c3.6,0,6.1,0.8,7.8,2.4c1.7,1.6,2.7,3.8,2.7,6.9c0,3.1-1,5.7-2.8,7.4
                                c-1.8,1.8-4.8,2.8-8.5,2.8c-1.8,0-3.2-0.1-4.5-0.2V147.5z"/>
                            <path className="st0" d="M171.5,158.2c0-1.6-0.7-4.1-3.5-4.1c-2.5,0-3.6,2.3-3.8,4.1H171.5z M164.1,160c0.1,3.4,2.2,4.8,4.7,4.8
                                c1.8,0,2.9-0.3,3.8-0.7l0.4,1.8c-0.9,0.4-2.4,0.9-4.6,0.9c-4.2,0-6.8-2.8-6.8-6.9c0-4.1,2.5-7.4,6.5-7.4c4.5,0,5.7,3.9,5.7,6.5
                                c0,0.5-0.1,0.9-0.1,1.2H164.1z"/>
                            <path className="st0" d="M178,152.7l2.7,7.7c0.5,1.3,0.8,2.4,1.1,3.5h0.1c0.3-1.1,0.7-2.3,1.2-3.5l2.7-7.7h2.6l-5.4,13.8h-2.4l-5.2-13.8
                                H178z"/>
                            <path className="st0" d="M199.2,158.2c0-1.6-0.7-4.1-3.5-4.1c-2.5,0-3.6,2.3-3.8,4.1H199.2z M191.8,160c0.1,3.4,2.2,4.8,4.7,4.8
                                c1.8,0,2.9-0.3,3.8-0.7l0.4,1.8c-0.9,0.4-2.4,0.9-4.6,0.9c-4.2,0-6.8-2.8-6.8-6.9c0-4.1,2.4-7.4,6.5-7.4c4.5,0,5.7,3.9,5.7,6.5
                                c0,0.5-0.1,0.9-0.1,1.2H191.8z"/>
                            <rect x="204.7" y="146.3" className="st0" width="2.5" height="20.2"/>
                            <path className="st0" d="M213,159.6c0,3,1.7,5.3,4.2,5.3c2.4,0,4.2-2.2,4.2-5.3c0-2.3-1.2-5.3-4.1-5.3C214.3,154.2,213,157,213,159.6
                                 M223.9,159.4c0,5.1-3.5,7.3-6.9,7.3c-3.7,0-6.6-2.7-6.6-7.1c0-4.6,3-7.3,6.8-7.3C221.3,152.4,223.9,155.2,223.9,159.4"/>
                            <path className="st0" d="M229.6,160.8c0,0.4,0.1,0.7,0.1,1c0.5,1.7,2,2.9,3.8,2.9c2.6,0,4.2-2.2,4.2-5.3c0-2.8-1.5-5.1-4.1-5.1
                                c-1.7,0-3.3,1.2-3.8,3.1c-0.1,0.3-0.2,0.7-0.2,1V160.8z M227.1,157.2c0-1.8-0.1-3.2-0.1-4.5h2.3l0.1,2.4h0c1-1.7,2.7-2.7,4.9-2.7
                                c3.3,0,5.8,2.8,5.8,7c0,4.9-3,7.4-6.3,7.4c-1.8,0-3.4-0.8-4.2-2.2h-0.1v7.5h-2.5V157.2z"/>
                            <path className="st0" d="M252.4,158.2c0-1.6-0.7-4.1-3.5-4.1c-2.5,0-3.6,2.3-3.8,4.1H252.4z M245,160c0.1,3.4,2.2,4.8,4.7,4.8
                                c1.8,0,2.9-0.3,3.8-0.7l0.4,1.8c-0.9,0.4-2.4,0.9-4.6,0.9c-4.2,0-6.8-2.8-6.8-6.9c0-4.1,2.4-7.4,6.5-7.4c4.5,0,5.7,3.9,5.7,6.5
                                c0,0.5-0.1,0.9-0.1,1.2H245z"/>
                            <path className="st0" d="M257.9,157c0-1.6,0-3-0.1-4.3h2.2l0.1,2.7h0.1c0.6-1.8,2.1-3,3.8-3c0.3,0,0.5,0,0.7,0.1v2.4
                                c-0.3-0.1-0.5-0.1-0.9-0.1c-1.8,0-3,1.3-3.4,3.2c-0.1,0.3-0.1,0.7-0.1,1.2v7.3h-2.5V157z"/>
                            <path className="st0" d="M282.9,158.2c0-1.6-0.7-4.1-3.5-4.1c-2.5,0-3.7,2.3-3.8,4.1H282.9z M275.6,160c0.1,3.4,2.2,4.8,4.7,4.8
                                c1.8,0,2.9-0.3,3.8-0.7l0.4,1.8c-0.9,0.4-2.4,0.9-4.6,0.9c-4.2,0-6.8-2.8-6.8-6.9c0-4.1,2.5-7.4,6.5-7.4c4.5,0,5.7,3.9,5.7,6.5
                                c0,0.5-0.1,0.9-0.1,1.2H275.6z"/>
                            <path className="st0" d="M299.1,166.4l-2.5-4.2c-1-1.6-1.6-2.7-2.2-3.8h-0.1c-0.5,1.1-1.1,2.1-2.1,3.8l-2.3,4.2h-2.8l5.9-9.7l-5.6-9.5
                                h2.9l2.5,4.5c0.7,1.3,1.3,2.2,1.8,3.2h0.1c0.5-1.1,1-2,1.7-3.2l2.6-4.5h2.9l-5.8,9.3l6,9.8H299.1z"/>
                            <path className="st0" d="M307.2,160.8c0,0.4,0.1,0.7,0.1,1c0.5,1.7,2,2.9,3.8,2.9c2.6,0,4.2-2.2,4.2-5.3c0-2.8-1.5-5.1-4.1-5.1
                                c-1.7,0-3.3,1.2-3.8,3.1c-0.1,0.3-0.2,0.7-0.2,1V160.8z M304.7,157.2c0-1.8-0.1-3.2-0.1-4.5h2.3l0.1,2.4h0c1-1.7,2.7-2.7,4.9-2.7
                                c3.3,0,5.8,2.8,5.8,7c0,4.9-3,7.4-6.3,7.4c-1.8,0-3.4-0.8-4.2-2.2h-0.1v7.5h-2.5V157.2z"/>
                            <path className="st0" d="M329.7,158.2c0-1.6-0.7-4.1-3.5-4.1c-2.5,0-3.6,2.3-3.8,4.1H329.7z M322.4,160c0.1,3.4,2.2,4.8,4.7,4.8
                                c1.8,0,2.9-0.3,3.8-0.7l0.4,1.8c-0.9,0.4-2.4,0.9-4.6,0.9c-4.2,0-6.8-2.8-6.8-6.9c0-4.1,2.5-7.4,6.5-7.4c4.5,0,5.7,3.9,5.7,6.5
                                c0,0.5-0.1,0.9-0.1,1.2H322.4z"/>
                            <path className="st0" d="M335.3,157c0-1.6,0-3-0.1-4.3h2.2l0.1,2.7h0.1c0.6-1.8,2.1-3,3.8-3c0.3,0,0.5,0,0.7,0.1v2.4
                                c-0.3-0.1-0.5-0.1-0.9-0.1c-1.8,0-3,1.3-3.4,3.2c-0.1,0.3-0.1,0.7-0.1,1.2v7.3h-2.5V157z"/>
                            <path className="st0" d="M344.7,152.7h2.5v13.8h-2.5V152.7z M347.5,148.8c0,0.9-0.6,1.5-1.6,1.5c-0.9,0-1.5-0.7-1.5-1.5
                                c0-0.9,0.7-1.6,1.6-1.6C346.9,147.3,347.5,147.9,347.5,148.8"/>
                            <path className="st0" d="M360.1,158.2c0-1.6-0.7-4.1-3.5-4.1c-2.5,0-3.6,2.3-3.8,4.1H360.1z M352.8,160c0.1,3.4,2.2,4.8,4.7,4.8
                                c1.8,0,2.9-0.3,3.8-0.7l0.4,1.8c-0.9,0.4-2.4,0.9-4.6,0.9c-4.2,0-6.8-2.8-6.8-6.9c0-4.1,2.5-7.4,6.5-7.4c4.5,0,5.7,3.9,5.7,6.5
                                c0,0.5-0.1,0.9-0.1,1.2H352.8z"/>
                            <path className="st0" d="M365.7,156.4c0-1.4,0-2.6-0.1-3.7h2.2l0.1,2.3h0.1c0.7-1.3,2.3-2.6,4.6-2.6c1.9,0,4.9,1.1,4.9,5.9v8.2h-2.5
                                v-7.9c0-2.2-0.8-4.1-3.2-4.1c-1.7,0-2.9,1.2-3.4,2.6c-0.1,0.3-0.2,0.7-0.2,1.2v8.3h-2.5V156.4z"/>
                            <path className="st0" d="M391.3,165.9c-0.7,0.3-2.1,0.8-4,0.8c-4.2,0-6.9-2.8-6.9-7c0-4.2,2.9-7.3,7.4-7.3c1.5,0,2.8,0.4,3.5,0.7
                                l-0.6,1.9c-0.6-0.3-1.5-0.7-2.9-0.7c-3.2,0-4.9,2.3-4.9,5.2c0,3.2,2.1,5.1,4.8,5.1c1.4,0,2.4-0.4,3.1-0.7L391.3,165.9z"/>
                            <path className="st0" d="M402.8,158.2c0-1.6-0.7-4.1-3.5-4.1c-2.5,0-3.7,2.3-3.8,4.1H402.8z M395.5,160c0.1,3.4,2.2,4.8,4.7,4.8
                                c1.8,0,2.9-0.3,3.8-0.7l0.4,1.8c-0.9,0.4-2.4,0.9-4.6,0.9c-4.2,0-6.8-2.8-6.8-6.9c0-4.1,2.5-7.4,6.5-7.4c4.5,0,5.7,3.9,5.7,6.5
                                c0,0.5-0.1,0.9-0.1,1.2H395.5z"/>
                            <path className="st0" d="M34,106.3c1.9,0.3,4.7,0.4,8.1,0.4c10,0,19.2-3.6,19.2-14.5C61.3,82.1,52.5,78,42,78h-8V106.3z M34,70.7h8.8
                                c10.2,0,16.2-5.3,16.2-12.5c0-8.7-6.7-12.1-16.4-12.1c-4.4,0-7,0.3-8.5,0.7V70.7z M24.4,40.2c4.2-0.9,10.9-1.5,17.6-1.5
                                c9.6,0,15.8,1.7,20.5,5.4c3.9,2.9,6.2,7.3,6.2,13.1c0,7.2-4.8,13.5-12.6,16.3v0.2c7.1,1.8,15.4,7.6,15.4,18.7
                                c0,6.4-2.5,11.3-6.3,14.9c-5.2,4.8-13.6,7-25.8,7c-6.6,0-11.7-0.4-15-0.9V40.2z"/>
                            <path className="st0" d="M94.1,106c2.4,0.4,6,0.6,9.7,0.6c20.6,0,31.8-11.5,31.8-31.6c0.1-17.6-9.9-28.7-30.2-28.7c-5,0-8.8,0.4-11.3,1
                                V106z M84.4,40.2c5.9-0.9,12.9-1.5,20.5-1.5c13.8,0,23.7,3.2,30.2,9.3c6.6,6.1,10.5,14.7,10.5,26.7c0,12.1-3.8,22.1-10.8,28.9
                                c-7,7-18.5,10.7-33,10.7c-6.9,0-12.6-0.3-17.5-0.9V40.2z"/>
                            <path className="st0" d="M196.1,113.6l-9.5-16.5c-3.9-6.3-6.3-10.4-8.6-14.7h-0.2c-2.1,4.3-4.2,8.3-8.1,14.8l-9,16.3h-11.1L172.4,76
                                l-21.9-36.8h11.2l9.9,17.4c2.8,4.9,4.9,8.6,6.9,12.6h0.3c2.1-4.4,4-7.8,6.8-12.6l10.2-17.4h11.1L184,75.4l23.3,38.2H196.1z"/>
                            <g>
                                <linearGradient id="SVGID_1_" gradientUnits="userSpaceOnUse" x1="224.5824" y1="76.5303" x2="440.5824" y2="73.197">
                                    <stop  offset="0" style={{ 'stop-color': '#D42B23' }}/>
                                    <stop  offset="1" style={{ 'stop-color': '#FAC31A' }}/>
                                </linearGradient>

                                <linearGradient id="logo-gradient" x1="50%" y1="0%" x2="50%" y2="100%" >

                                    <stop offset="0%" stopColor="#D42B23">
                                        <animate attributeName="stop-color" values="#7A5FFF; #01FF89; #7A5FFF" dur="4s" repeatCount="indefinite"></animate>
                                    </stop>

                                    <stop offset="100%" stopColor="#FAC31A">
                                        <animate attributeName="stop-color" values="#01FF89; #7A5FFF; #01FF89" dur="4s" repeatCount="indefinite"></animate>
                                    </stop>

                                </linearGradient>

                                <path className="st1" d="M356,43.7c-9.5,0-14.3,5.1-14.3,15.2V90c0,10.2,4.8,15.3,14.3,15.3c9.5,0,14.3-5.1,14.3-15.3V58.9
                                    C370.2,48.8,365.5,43.7,356,43.7z"/>
                                <linearGradient id="SVGID_2_" gradientUnits="userSpaceOnUse" x1="224.5611" y1="75.148" x2="440.67" y2="71.813">
                                    <stop  offset="0" style={{ 'stop-color': '#D42B23' }}/>
                                    <stop  offset="1" style={{ 'stop-color': '#FAC31A' }}/>
                                </linearGradient>
                                <path className="st2" d="M406,51.1l-0.1-0.1V23.2c0-5.8-4.7-10.6-10.6-10.6h-94.4h-40.2h-12.8c-5.8,0-10.6,4.7-10.6,10.6v27.6l-0.1,0.2
                                    c0,13.1-10.6,23.7-23.7,23.8v0c13.1,0,23.7,10.7,23.7,23.8l0.1,0.3v25.2c0,5.8,4.7,10.6,10.6,10.6h9.5H292h103.4
                                    c5.8,0,10.6-4.7,10.6-10.6V98.8l0.1-0.1c0-13.1,10.6-23.8,23.7-23.8v0C416.6,74.8,406,64.2,406,51.1z M273,108.2
                                    c0,0.8-0.3,1.4-1,1.9c-0.7,0.5-1.4,0.7-2.3,0.7c-0.9,0-1.7-0.2-2.4-0.7c-0.6-0.5-1-1.1-1-1.9V40c0-1.6,1.1-2.4,3.3-2.4
                                    c2.2,0,3.3,0.8,3.3,2.4V108.2z M325.7,37.8l-38,74.2c-0.4,1-1.2,1.5-2.5,1.5c-0.7,0-1.3-0.3-1.8-0.8c-0.5-0.5-0.8-1.1-0.8-1.8
                                    c0-0.4,0.1-0.8,0.3-1.2L321.2,35c0.3-0.8,1-1.2,2-1.2c0.7,0,1.3,0.3,2,0.8c0.6,0.5,1,1.2,1,1.9C326.1,37,326,37.5,325.7,37.8z
                                     M376.9,90c0,7.4-1.9,12.8-5.7,16.3c-3.8,3.4-8.9,5.2-15.2,5.2c-6.4,0-11.4-1.7-15.2-5.2c-3.8-3.4-5.7-8.9-5.7-16.3V58.9
                                    c0-7.3,1.9-12.7,5.7-16.2c3.8-3.4,8.9-5.2,15.2-5.2c6.4,0,11.4,1.7,15.2,5.2c3.8,3.4,5.7,8.8,5.7,16.2V90z"/>
                            </g>
                        </svg>
                );
            }
        }
    }

    DisplayPage.propTypes = {
        gsheet: PropTypes.object.isRequired,
    };

    const mapStateToProps = (state) => {
        return {
            gsheet: state.gsheet
        };
    };

    return connect(mapStateToProps)(DisplayPage)
};

export default displayPage;